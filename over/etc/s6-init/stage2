#!/usr/bin/execlineb -P
foreground { echo "* stage2 started." }

foreground {
  elglob -0 files /etc/s6-init/stage2.d/*
  forx -p file { $files }
  import -iu file
  $file
}

if {
  cd /etc/s6-rc
  if -nt { test -e compiled }
  if {
    backtick -in dest { readlink compiled }
    import -u dest
    s6-rc-compile $dest /etc/s6
  }
  echo "* s6-rc db recompiled."
}

if { s6-rc-init /run/s6 }
s6-rc -u change ok
